<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f0f23">
    <title>{% block title %}BrainRotGuard{% endblock %}</title>
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <div class="logo">
            <a href="/"><img src="/static/logo.png" alt="BrainRotGuard" class="logo-img"></a>
            <a href="https://github.com/GHJJ123/brainrotguard/blob/main/CHANGELOG.md" target="_blank" rel="noopener" class="version-tag">v{{ app_version }}</a>
        </div>
        <div class="search-dropdown-wrap">
            <button type="button" class="search-toggle" onclick="var d=this.nextElementSibling;d.classList.toggle('open');if(d.classList.contains('open'))d.querySelector('input').focus();">&#x1F50D;</button>
            <div class="search-dropdown">
                <div class="avatar-dd-label">Search YouTube</div>
                <form action="/search" method="GET" class="search-dd-form">
                    <input type="text" name="q" placeholder="Search or paste a link..." class="search-dd-input">
                    <button type="submit" class="btn-primary search-dd-go">Go</button>
                </form>
            </div>
        </div>
        <form action="/search" method="GET" class="header-search">
            <input type="text" name="q" placeholder="Search or paste a link..." class="header-search-input" {% block search_attrs %}{% endblock %}>
            <button type="submit" class="btn-primary header-search-btn">Search</button>
        </form>
        {% if child_name %}
        <div class="avatar-dropdown-wrap">
            <button type="button" class="profile-badge avatar-toggle" onclick="document.querySelector('.avatar-dropdown').classList.toggle('open')">
                <span class="profile-avatar" id="hdr-avatar" style="{% if avatar_color %}background:{{ avatar_color }}{% endif %}">{{ avatar_icon if avatar_icon else child_name[0] }}</span>
            </button>
            <div class="avatar-dropdown">
                <div class="avatar-dd-greeting">Hi {{ child_name }}!</div>
                <div class="avatar-dd-label">Pick your icon</div>
                <div class="avatar-grid">
                    {% for ic in avatar_icons %}
                    <button type="button" class="avatar-option{% if ic == avatar_icon %} selected{% endif %}" data-icon="{{ ic }}">{{ ic }}</button>
                    {% endfor %}
                </div>
                <div class="avatar-dd-label">Pick your color</div>
                <div class="color-grid">
                    {% for c in avatar_colors %}
                    <button type="button" class="color-option{% if c == avatar_color %} selected{% endif %}" data-color="{{ c }}" style="background:{{ c }}"></button>
                    {% endfor %}
                </div>
                {% if multi_profile %}
                <a href="/switch-profile" class="avatar-switch-link">Switch Profile</a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </header>
    <main>
        {% block content %}{% endblock %}
    </main>
    <footer>
        <a href="https://ko-fi.com/coffee4jj" target="_blank" rel="noopener">â˜• Buy me a coffee</a>
    </footer>
    {% block scripts %}{% endblock %}
    <script>
    (function(){
        // Search dropdown: outside-click close
        var sw=document.querySelector('.search-dropdown-wrap');
        if(sw){var sd=sw.querySelector('.search-dropdown');document.addEventListener('click',function(e){if(!sw.contains(e.target))sd.classList.remove('open')})}
        var wrap=document.querySelector('.avatar-dropdown-wrap');
        if(!wrap) return;
        var dd=wrap.querySelector('.avatar-dropdown');
        var av=document.getElementById('hdr-avatar');
        // Close on outside click
        document.addEventListener('click',function(e){if(!wrap.contains(e.target))dd.classList.remove('open')});
        // Icon selection
        dd.querySelectorAll('.avatar-option').forEach(function(btn){
            btn.addEventListener('click',function(){
                dd.querySelectorAll('.avatar-option').forEach(function(b){b.classList.remove('selected')});
                btn.classList.add('selected');
                var icon=btn.dataset.icon;
                av.textContent=icon;
                fetch('/api/avatar',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({icon:icon})});
            });
        });
        // Color selection
        dd.querySelectorAll('.color-option').forEach(function(btn){
            btn.addEventListener('click',function(){
                dd.querySelectorAll('.color-option').forEach(function(b){b.classList.remove('selected')});
                btn.classList.add('selected');
                var color=btn.dataset.color;
                av.style.background=color;
                fetch('/api/avatar',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({color:color})});
            });
        });
    })();
    </script>
</body>
</html>
